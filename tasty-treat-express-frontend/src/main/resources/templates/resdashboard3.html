<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TastyTreatExpress - Restaurant Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: #fff;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #eee;
        }

        .sidebar-header h2 {
            font-size: 18px;
            color: #007bff;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #f0f5ff;
            color: #007bff;
        }

        .sidebar-menu a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
			margin-left:0;
			overflow-y: auto; 
        }

        .card {
			width:100%;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .page-header {
            margin-bottom: 20px;
        }

        .page-header h2 {
            font-size: 22px;
            color: #333;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #0069d9;
        }

        /* Table Styles */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
        }
		/* Reports Section Styles */
		#generateReportForm {
		    display: flex;
		    flex-direction: column;
		    gap: 15px;
		}

		#generateReportForm .form-group {
		    margin-bottom: 0;
		}

		.report-actions {
		    display: flex;
		    gap: 5px;
		    flex-wrap: wrap;
		}

		.report-actions .btn {
		    padding: 5px 10px;
		    font-size: 0.8rem;
		}
        /* Status Badges */
        .status-popular {
            background-color: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .status-regular {
            background-color: #2196F3;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .status-lowDemand {
            background-color: #FFC107;
            color: #333;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .btn-danger {
            background-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }
		/* Order Status Badges */
		.status-PENDING {
		    background-color: #FFC107;
		    color: #212529;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-PREPARING {
		    background-color: #2196F3;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-SHIPPED {
		    background-color: #17a2b8;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-DELIVERED {
		    background-color: #28a745;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-CANCELLED {
		    background-color: #dc3545;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		/* Order Actions */
		.order-actions {
		    display: flex;
		    gap: 5px;
		    flex-wrap: wrap;
		}

		.order-actions .btn {
		    padding: 5px 10px;
		    font-size: 0.8rem;
		}
		

		

    </style>
</head>
<body>
	
	<div class="container">
	       <!-- Sidebar -->
	       <div class="sidebar">
	           <div class="sidebar-header">
	               <h2>TastyTreatExpress</h2>
	           </div>
	           <ul class="sidebar-menu">
	               <li><a href="#" class="active"><i class="fas fa-list"></i> Menu Management</a></li>
				   <li><a href="#" onclick="showFeedbackSection()"><i class="fas fa-comments"></i> Feedbacks</a></li>
				   <li><a href="#" onclick="showOrdersSection()"><i class="fas fa-receipt"></i> Orders</a></li>
				  
				   <li><a href="#" onclick="showReportsSection()"><i class="fas fa-file-alt"></i> Reports</a></li>
				   <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
	           </ul>
	       </div>
		   
		   <div class="main-content">
			<div th:if="${restaurant != null}">
			               <h2>Welcome, <span th:text="${restaurant.name}"></span></h2>
			               <h3>Restaurant Information</h3>
			               <div id="restaurant-info">
							<p><strong>Email:</strong> <span th:text="${restaurant.email}"></span></p>
							<p><strong>Address:</strong> <span th:text="${restaurant.address}"></span></p>
							<p><strong>Phone:</strong> <span th:text="${restaurant.phoneNumber}"></span></p>
							</div>
			           </div>
			           <div th:unless="${restaurant != null}">
			               <p>No restaurant data found. Please login again.</p>
			               <a href="/?showRestaurantLogin=true">Login</a>
			           </div>
		       <div id="feedbackSection" class="content-section" style="display: none;">
		           <div class="card">
		               <h3>User Feedbacks</h3>
		               <div class="table-responsive">
		                   <table class="table" id="feedbackTable">
		                       <thead>
		                           <tr>
		                               <th>User</th>
		                               <th>Rating</th>
		                               <th>Comments</th>
		                               <th>Date</th>
		                           </tr>
		                       </thead>
		                       <tbody id="feedbackBody">
		                           <!-- Feedbacks will be loaded here dynamically -->
		                       </tbody>
		                   </table>
		               </div>
		           </div>
		       </div>
			   <!-- Response Modal -->
			   <div class="modal" id="responseModal" style="display: none;">
			       <div class="modal-content">
			           <div class="modal-header">
			               <h3>Respond to Feedback</h3>
			               <button class="close-modal" onclick="closeResponseModal()">&times;</button>
			           </div>
			           <div class="modal-body">
			               <textarea id="responseText" placeholder="Type your response here..."></textarea>
			           </div>
			           <div class="modal-footer">
			               <button class="btn" onclick="submitResponse()">Send Response</button>
			           </div>
			       </div>
			   </div>
	
	      
	          
			   <!-- Order Details Modal -->
			   <div class="modal" id="orderDetailsModal">
			       <div class="modal-content">
			           <div class="modal-header">
			               <h3>Order Details</h3>
			               <button class="close-modal" onclick="closeOrderModal()">&times;</button>
			           </div>
			           <div id="orderDetailsContent">
						<p><strong>Status:</strong> <span id="orderStatus"></span></p> <!-- Add this line -->
						           <p><strong>Order ID:</strong> <span id="orderId"></span></p> <!-- Optional: Add Order ID -->
						           <p><strong>Customer ID:</strong> <span id="customerId"></span></p> <!-- Optional: Add Customer ID -->
						           <p><strong>Order Time:</strong> <span id="orderTime"></span></p> <!-- Optional: Add Order Time -->
						           <p><strong>Delivery Address:</strong> <span id="deliveryAddress"></span></p> <!-- Optional: Add Delivery Address -->
						           <p><strong>Payment Status:</strong> <span id="paymentStatus"></span></p> <!-- Optional: Add Payment Status -->
						           <h5>Items:</h5>
						           <ul id="orderItemsList"></ul> <!-- Add this line for items -->
						           <div class="order-total">
						               <strong>Total Amount:</strong> <span id="totalAmount"></span> <!-- Add this line for total amount -->
						           </div>
					   </div>
					   </div>
					   </div>
			         
					   <!-- Add this with your other content sections -->
					   <div id="reportsSection" class="content-section" style="display: none;">
					       <div class="card">
					           <h3>Generate New Report</h3>
					           <form id="generateReportForm" onsubmit="generateReport(event)">
					               <div class="form-group">
					                   <label for="reportType">Report Type:</label>
					                   <select id="reportType" name="reportType" required>
					                       <option value="SALES">Sales Report</option>
					                       <option value="ORDERS">Orders Report</option>
					                       <option value="MENU_ITEMS">Menu Items Report</option>
					                       <option value="FEEDBACK">Feedback Report</option>
					                   </select>
					               </div>
					               <div class="form-group">
					                   <label for="startDate">Start Date:</label>
					                   <input type="date" id="startDate" name="startDate" required>
					               </div>
					               <div class="form-group">
					                   <label for="endDate">End Date:</label>
					                   <input type="date" id="endDate" name="endDate" required>
					               </div>
					               <button type="submit" class="btn">Generate Report</button>
					           </form>
					       </div>

					       <div class="card">
					           <h3>Your Reports</h3>
					           <div class="table-responsive">
					               <table class="table" id="reportsTable">
					                   <thead>
					                       <tr>
					                           <th>Report ID</th>
					                           <th>Type</th>
					                           <th>Date Range</th>
					                           <th>Generated On</th>
					                           <th>Actions</th>
					                       </tr>
					                   </thead>
					                   <tbody id="reportsBody">
					                       <!-- Reports will be loaded here dynamically -->
					                   </tbody>
					               </table>
					           </div>
					       </div>
					   </div> 
			   <div id="ordersSection" class="content-section" style="display: none;">
			                  <div class="card">
			                   <h3>Recent Orders</h3>
			                   <div class="table-responsive">
			                       <table class="table" id="ordersTable">
			                           <thead>
			                               <tr>
			                                   <th>Order ID</th>
			                                   <th>Customer</th>
			                                   <th>Items</th>
			                                   <th>Total</th>
			                                   <th>Status</th>
			                                   <th>Order Time</th>
			                                   <th>Actions</th>
			                               </tr>
			                           </thead>
			                           <tbody id="ordersBody">
			                               <!-- Orders will be loaded here dynamically -->
			                           </tbody>
			                       </table>
			                   </div>
			               </div>
                    </div>
			               <!-- Add New Item Form -->
						   <div id="menuSection" class="content-section">
			               <div class="card">
			                   <h3>Add New Menu Item</h3>
			                   <form id="addMenuItemForm" onsubmit="handleAddMenuItem(event)">
			                       <div class="form-group">
			                           <label for="name">Name:</label>
			                           <input type="text" id="name" name="name" required>
			                       </div>
			                       <div class="form-group">
			                           <label for="description">Description:</label>
			                           <textarea id="description" name="description"></textarea>
			                       </div>
			                       <div class="form-group">
			                           <label for="price">Price:</label>
			                           <input type="number" id="price" name="price" step="0.01" min="0" required>
			                       </div>
			                       <div class="form-group">
			                           <label for="quantity">Quantity:</label>
			                           <input type="number" id="quantity" name="quantity" min="0" required>
			                       </div>
			                       <div class="form-group">
			                           <label for="category">Category:</label>
			                           <select id="category" name="category">
			                               <option value="Appetizer">Appetizer</option>
			                               <option value="Main Course">Main Course</option>
			                               <option value="Dessert">Dessert</option>
			                               <option value="Beverage">Beverage</option>
			                           </select>
			                       </div>
			                       
	              
	                   <button type="submit" class="btn">Add Item</button>
	               </form>
	           </div>

	           <!-- Menu Items Table -->
	           <div class="card">
	               <h3>Your Menu Items</h3>
	               <div class="table-responsive">
	                   <table class="table" id="menuItemsTable">
	                       <thead>
	                           <tr>
	                               <th>Name</th>
	                               <th>Description</th>
	                               <th>Price</th>
	                               <th>Quantity</th>
	                               <th>Category</th>
	                               <th>Status</th>
								       <th>Actions</th>
								                           </tr>
								                       </thead>
								                       <tbody id="menuItemsBody">
								                           
								                       </tbody>
								                   </table>
								               </div>
								           </div>
								       

								   <!-- Edit Menu Item Modal -->
								   <div class="modal" id="editModal">
								       <div class="modal-content">
								           <div class="modal-header">
								               <h3>Edit Menu Item</h3>
								               <button class="close-modal" onclick="closeEditModal()">&times;</button>
								           </div>
								           <form id="editMenuItemForm" onsubmit="handleUpdateMenuItem(event)">
								               <input type="hidden" id="editItemId" name="menuId" value="1">
								               <div class="form-group">
								                   <label for="editName">Name:</label>
								                   <input type="text" id="editName" name="name" required>
								               </div>
								               <div class="form-group">
								                   <label for="editDescription">Description:</label>
								                   <textarea id="editDescription" name="description"></textarea>
								               </div>
								               <div class="form-group">
								                   <label for="editPrice">Price:</label>
								                   <input type="number" id="editPrice" name="price" step="0.01" min="0" required>
								               </div>
								               <div class="form-group">
								                   <label for="editQuantity">Quantity:</label>
								                   <input type="number" id="editQuantity" name="quantity" min="0" required>
								               </div>
								               <div class="form-group">
								                   <label for="editCategory">Category:</label>
								                   <select id="editCategory" name="category">
								                       <option value="Appetizer">Appetizer</option>
								                       <option value="Main Course">Main Course</option>
								                       <option value="Dessert">Dessert</option>
								                       <option value="Beverage">Beverage</option>
								                   </select>
								               </div>
								               <div class="form-actions">
								                   <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
								                   <button type="submit" class="btn btn-primary">Update Item</button>
								               </div>
								           </form>
								       </div>
								   </div>
								   </div>

								   <div id="restaurantData" 
								        th:data-restaurant-id="${restaurant.restaurantId}"
								        th:data-name="${restaurant.name}"
								        th:data-email="${restaurant.email}"
								        th:data-address="${restaurant.address}"
								        th:data-phone="${restaurant.phoneNumber}"
								        style="display: none;"></div>
</div>
</div>
								   <script>
								       // Global variable to store restaurant data
								       let currentRestaurant = null;

								       // On page load
								       document.addEventListener('DOMContentLoaded', function() {
								           const dataElement = document.getElementById('restaurantData');
								           const restaurantData = {
								               restaurantId: dataElement.dataset.restaurantId,
								               name: dataElement.dataset.name,
								               email: dataElement.dataset.email,
								               address: dataElement.dataset.address,
								               phoneNumber: dataElement.dataset.phone
								           };
								           sessionStorage.setItem('restaurant', JSON.stringify(restaurantData));
								           currentRestaurant = restaurantData;

								           // Load menu items
								           loadMenuItems();
										   loadOrders();
								       });

								       function loadMenuItems() {
								           if (!currentRestaurant || !currentRestaurant.restaurantId) {
								               console.error('No restaurant data available');
								               return;
								           }

								           fetch(`http://localhost:8080/api/menuItems/restaurant/${currentRestaurant.restaurantId}`)
								               .then(response => {
								                   if (!response.ok) throw new Error('Failed to fetch menu items');
								                   return response.json();
								               })
								               .then(items => {
								                   const tbody = document.getElementById('menuItemsBody');
								                   tbody.innerHTML = '';

								                   items.forEach(item => {
								                       const row = document.createElement('tr');
								                       row.innerHTML = `
								                           <td>${item.name}</td>
								                           <td>${item.description || ''}</td>
								                           <td>$${item.price.toFixed(2)}</td>
								                           <td>${item.quantity}</td>
								                           <td>${item.category}</td>
								                           <td>
								                               <span class="status-${getStatus(item)}">${getStatus(item)}</span>
								                           </td>
								                           <td>
								                               <button class="btn btn-warning" 
								                                   data-id="${item.menuId}"
								                                   data-name="${item.name}"
								                                   data-description="${item.description || ''}"
								                                   data-price="${item.price}"
								                                   data-quantity="${item.quantity}"
														  data-category="${item.category}"
																                                       onclick="openEditModal(this)">
																                                       Edit
																                                   </button>
																                                   <button class="btn btn-danger" onclick="deleteMenuItem('${item.menuId}')">Delete</button>
																                               </td>
																                           `;
																                           tbody.appendChild(row);
																                       });
																                   })
																                   .catch(error => {
																                       console.error('Error loading menu items:', error);
																                       alert('Failed to load menu items: ' + error.message);
																                   });
																           }

																		   function loadOrders() {
																		       if (!currentRestaurant || !currentRestaurant.restaurantId) {
																		           console.error('No restaurant data available');
																		           return;
																		       }

																		       fetch(`http://localhost:8080/api/orders/restaurant/${currentRestaurant.restaurantId}`)
																		           .then(response => {
																		               if (!response.ok) throw new Error('Failed to fetch orders');
																		               return response.json();
																		           })
																		           .then(orders => {
																		               const tbody = document.getElementById('ordersBody');
																		               tbody.innerHTML = '';

																		               if (!orders || orders.length === 0) {
																		                   tbody.innerHTML = '<tr><td colspan="7" class="text-center">No orders found</td></tr>';
																		                   return;
																		               }

																		               // Fetch menu item details for each order
																		               const menuItemPromises = orders.map(order => {
																		                   return fetchMenuItems(order.menuItemIds).then(menuItems => {
																		                       return { ...order, menuItems }; // Combine order with its menu items
																		                   });
																		               });

																		               // Wait for all menu item details to be fetched
																		               Promise.all(menuItemPromises).then(ordersWithItems => {
																		                   ordersWithItems.forEach(order => {
																		                       const itemsList = order.menuItems && Array.isArray(order.menuItems) ?
																		                           order.menuItems.map(item => `<li>${item.quantity}x ${item.name}</li>`).join('') :
																		                           '<li>No items found</li>';

																		                       const row = document.createElement('tr');
																		                       row.innerHTML = `
																		                           <td>${order.orderId}</td>
																		                           <td>${order.userId}</td>
																		                           <td>
																		                               <ul class="order-items-list">
																		                                   ${itemsList}
																		                               </ul>
																		                           </td>
																		                           <td>$${order.totalAmount.toFixed(2)}</td>
																								   <td>
																								     <select class="status-dropdown" data-order-id="${order.orderId}" onchange="updateOrderStatus(this)">
																								           <option value="PENDING" ${order.status === 'PENDING' ? 'selected' : ''}>Pending</option>
																								            <option value="PREPARING" ${order.status === 'PREPARING' ? 'selected' : ''}>Preparing</option>
																								            <option value="SHIPPED" ${order.status === 'SHIPPED' ? 'selected' : ''}>Shipped</option>
																								           <option value="DELIVERED" ${order.status === 'DELIVERED' ? 'selected' : ''}>Delivered</option>
																								            <option value="CANCELLED" ${order.status === 'CANCELLED' ? 'selected' : ''}>Cancelled</option>
																								       </select>
																								    </td>
																		                           <td>${new Date(order.orderDate).toLocaleString()}</td>
																		                           <td>
																		                               <div class="order-actions">
																		                                   <button class="btn btn-info" onclick="viewOrderDetails(${order.orderId})">
																		                                       <i class="fas fa-eye"></i>
																		                                   </button>
																		                               </div>
																		                           </td>
																		                       `;
																		                       tbody.appendChild(row);
																		                   });
																		               });
																		           })
																		           .catch(error => {
																		               console.error('Error loading orders:', error);
																		               const tbody = document.getElementById('ordersBody');
																		               tbody.innerHTML = `<tr><td colspan="7" class="text-center">Error loading orders: ${error.message}</td></tr>`;
																		           });
																		   }

																		   // Function to fetch menu items based on their IDs
			
																		          function getStatus(item) {
																		              if (item.quantity > 20) return 'popular';
																		              if (item.quantity > 5) return 'regular';
																		              return 'lowDemand';
																		          }


																		   function openEditModal(button) {
																		       const itemId = button.getAttribute('data-id'); // Change from data-menuId to data-id
																		       const itemName = button.getAttribute('data-name');
																		       const itemDescription = button.getAttribute('data-description');
																		       const itemPrice = button.getAttribute('data-price');
																		       const itemQuantity = button.getAttribute('data-quantity');
																		       const itemCategory = button.getAttribute('data-category');

																		       document.getElementById('editItemId').value = itemId; // Ensure this is set correctly
																		       document.getElementById('editName').value = itemName;
																		       document.getElementById('editDescription').value = itemDescription || '';
																		       document.getElementById('editPrice').value = itemPrice;
																		       document.getElementById('editQuantity').value = itemQuantity;
																		       document.getElementById('editCategory').value = itemCategory;

																		       document.getElementById('editModal').style.display = 'flex';
																		   }

																           // Close edit modal
																           function closeEditModal() {
																               document.getElementById('editModal').style.display = 'none';
																           }
																		   function handleAddMenuItem(e) {
																		           e.preventDefault(); // Prevent the default form submission

																		           const formData = new FormData(e.target);
																		           const itemData = {
																		               name: formData.get('name'),
																		               description: formData.get('description'),
																		               price: parseFloat(formData.get('price')),
																		               quantity: parseInt(formData.get('quantity')),
																		               category: formData.get('category')
																		           };

																		           const restaurantId = currentRestaurant.restaurantId; // Ensure currentRestaurant is set

																		           fetch(`http://localhost:8080/api/menuItems/add/${restaurantId}`, {
																		               method: 'POST',
																		               headers: {
																		                   'Content-Type': 'application/json'
																		               },
																		               body: JSON.stringify(itemData)
																		           })
																		           .then(response => {
																		               if (!response.ok) throw new Error('Failed to add item');
																		               return response.json();
																		           })
																				           .then(() => {
																				               alert('Item added successfully!');
																				               e.target.reset(); // Reset the form fields
																				               loadMenuItems(); // Reload the menu items to reflect the new addition
																				           })
																				           .catch(error => {
																				               console.error('Error:', error);
																				               alert('Failed to add item: ' + error.message);
																				           });
																				       }
																				   
																					   function handleUpdateMenuItem(e) {
																					       e.preventDefault();
																					       const formData = new FormData(e.target);
																					       const itemData = Object.fromEntries(formData);
																						   if (!itemData.menuId || isNaN(itemData.menuId)) {
																						       alert('Invalid item ID');
																						       return;
																						   }

																					       fetch(`http://localhost:8080/api/menuItems/update`, {
																					           method: 'PUT',
																					           headers: {
																					               'Content-Type': 'application/json'
																					           },
																					           body: JSON.stringify({
																								menuId: parseInt(itemData.menuId), // Ensure this is a number
																								           name: itemData.name,
																								           description: itemData.description,
																								           price: parseFloat(itemData.price),
																								           category: itemData.category,
																								           imageUrl: itemData.imageUrl, // Include this if it's part of the form
																								           quantity: parseInt(itemData.quantity),
																								           isAvailable: itemData.isAvailable === 'true', // Convert to boolean
																								           status: itemData.status, // Include this if it's part of the form
																								           
																					           })
																					       })
																					       .then(response => {
																					           if (!response.ok) throw new Error('Failed to update item');
																					           return response.json();
																					       })
																					       .then(() => {
																					           alert('Item updated successfully!');
																					           closeEditModal();
																					           loadMenuItems(); // Reload the menu items after updating
																					       })
																					       .catch(error => {
																					           console.error('Error:', error);
																					           alert('Failed to update item: ' + error.message);
																					       });
																					   }										           

																					   function deleteMenuItem(itemId) {
																					       if (!confirm('Are you sure you want to delete this item?')) return;

																					       fetch(`http://localhost:8080/api/menuItems/delete/${itemId}`, {
																					           method: 'DELETE'
																					       })
																					       .then(response => {
																					           if (!response.ok) throw new Error('Failed to delete item');
																					           return response.json(); // Ensure the response is valid JSON
																					       })
																					       .then(data => {
																					           alert(data.message || 'Item deleted successfully!'); // Use the message from the response
																					           loadMenuItems(); // Reload the menu items after deleting
																					       })
																					       .catch(error => {
																					           console.error('Error:', error);
																					           alert('Failed to delete item: ' + error.message);
																					       });
																					   }
																					   function viewOrderDetails(orderId) {
																					       fetch(`http://localhost:8080/api/orders/${orderId}`)
																					           .then(response => {
																					               if (!response.ok) throw new Error('Failed to fetch order details');
																					               return response.json();
																					           })
																					           .then(order => {
																								document.getElementById('orderStatus').value = order.status;
																								document.getElementById('orderStatus').innerText = order.status; // Set the order status
																								document.getElementById('orderId').innerText = order.orderId; // Set the order ID
																								document.getElementById('customerId').innerText = order.userId; // Set the customer ID
																							    document.getElementById('orderTime').innerText = new Date(order.orderDate).toLocaleString(); // Set the order time
																								document.getElementById('deliveryAddress').innerText = order.deliveryAddress; // Set the delivery address
																								document.getElementById('paymentStatus').innerText = order.paymentStatus; // Set the payment status

																					               // First fetch the menu items details
																					               const itemFetchPromises = order.menuItemIds.map(itemId => 
																					                   fetch(`http://localhost:8080/api/menuItems/${itemId}`)
																					                       .then(res => res.json())
																					               );

																								   return Promise.all(itemFetchPromises)
																								                   .then(items => {
																								                       const itemsList = document.getElementById('orderItemsList');
																								                       itemsList.innerHTML = ''; // Clear previous items
																								                       items.forEach(item => {
																								                           const listItem = document.createElement('li');
																								                           listItem.innerText = `${item.name} - $${item.price.toFixed(2)}`;
																								                           itemsList.appendChild(listItem);
																								                       });

																								                       return {
																								                           ...order,
																								                           items: items,
																								                           id: order.orderId,
																								                           orderTime: order.orderDate
																								                       };
																								                   });
																								           })
																					           .then(fullOrder => {
																					               const content = document.getElementById('orderDetailsContent');
																					               content.innerHTML = `
																					                   <div class="order-detail">
																					                       <h4>Order #${fullOrder.orderId || 'N/A'}</h4>
																					                       <p><strong>Customer ID:</strong> ${fullOrder.userId || 'Guest'}</p>
																					                       <p><strong>Status:</strong> <span class="status-${fullOrder.status || 'UNKNOWN'}">${fullOrder.status || 'UNKNOWN'}</span></p>
																					                       <p><strong>Order Time:</strong> ${
																					                           fullOrder.orderTime ? 
																					                           new Date(fullOrder.orderTime).toLocaleString() : 
																					                           'Not available'
																					                       }</p>
																					                       <p><strong>Delivery Address:</strong> ${fullOrder.deliveryAddress || 'Not specified'}</p>
																					                       <p><strong>Payment Status:</strong> ${fullOrder.paymentStatus || 'Not specified'}</p>
																					                       
																					                       <h5>Items:</h5>
																					                       ${fullOrder.items && fullOrder.items.length > 0 ? `
																					                           <ul class="order-items-detail">
																					                               ${fullOrder.items.map(item => `
																					                                   <li>
																					                                       1x ${item.name || 'Unknown Item'} - 
																					                                       $${(item.price || 0).toFixed(2)} each
																					                                   </li>
																					                               `).join('')}
																					                           </ul>
																					                       ` : '<p>No items in this order</p>'}
																					                       
																					                       <div class="order-total">
																					                           <strong>Total Amount:</strong> $${fullOrder.totalAmount?.toFixed(2) || '0.00'}
																					                       </div>
																					                   </div>
																					               `;
																					               document.getElementById('orderDetailsModal').style.display = 'flex';
																					           })
																					           .catch(error => {
																					               console.error('Error:', error);
																					               const content = document.getElementById('orderDetailsContent');
																					               content.innerHTML = `<p class="error">Error loading order details: ${error.message}</p>`;
																					               document.getElementById('orderDetailsModal').style.display = 'flex';
																					           });
																					   }
																					    function fetchMenuItems(menuItemIds) {
																					       const promises = menuItemIds.map(id => {
																					           return fetch(`http://localhost:8080/api/menuItems/${id}`) // Adjust this endpoint as needed
																					               .then(response => {
																					                   if (!response.ok) throw new Error('Failed to fetch menu item');
																					                   return response.json();
																					               });
																					       });

																					       return Promise.all(promises);
																					   }
																								   function closeOrderModal() {
																								       document.getElementById('orderDetailsModal').style.display = 'none';
																								   }
																					               function cancelOrder(orderId) {
																					                   if (!confirm('Are you sure you want to cancel this order?')) return;

																					                   fetch(`http://localhost:8080/api/orders/cancel/${orderId}`, {
																					                       method: 'PUT'
																					                   })
																									   .then(response => {
																									           if (!response.ok) throw new Error(`Server responded with status ${response.status}`);
																									           return response.json();
																									       })
																										   
																					                   .then(() => {
																					                       alert('Order cancelled successfully!');
																					                       loadOrders();
																					                   })
																					                   .catch(error => {
																					                       console.error('Error:', error);
																					                       alert('Failed to cancel order: ' + error.message);
																					                   });
																					               }
																								   // Update order status
																								   function updateOrderStatus(selectElement) {
																								       const orderId = selectElement.getAttribute('data-order-id');
																								       const newStatus = selectElement.value;

																								       if (!confirm(`Change order status to ${newStatus}?`)) return;

																								       fetch(`http://localhost:8080/api/orders/updateStatus/${orderId}/${newStatus}`, {
																								           method: 'PUT',
																								           headers: {
																								               'Content-Type': 'application/json'
																								           }
																								       })
																								       .then(response => {
																								           if (!response.ok) {
																								               // If the response is not OK, handle the error
																								               return response.text().then(text => {
																								                   throw new Error(text || 'Failed to update status');
																								               });
																								           }
																								           return response.json(); // Only parse as JSON if the response is OK
																								       })
																								       .then(updatedOrder => {
																								           alert('Status updated successfully!');
																								           loadOrders(); // Refresh the order list
																								       })
																								       .catch(error => {
																								           console.error('Error:', error);
																								           alert('Error updating status: ' + error.message);
																								       });
																								   }
																								   
																								   let currentFeedbackId = null; // To store the ID of the feedback being responded to

																								   function openResponseModal(feedbackId) {
																								       currentFeedbackId = feedbackId; // Store the feedback ID
																								       document.getElementById('responseModal').style.display = 'flex'; // Show the modal
																								   }

																								   function closeResponseModal() {
																								       document.getElementById('responseModal').style.display = 'none'; // Hide the modal
																								       document.getElementById('responseText').value = ''; // Clear the textarea
																								   }

																								   function submitResponse() {
																								       const responseText = document.getElementById('responseText').value;

																								       if (!responseText) {
																								           alert('Please enter a response before sending.');
																								           return;
																								       }

																								       const feedback = {
																								           feedbackId: currentFeedbackId,
																								           comments: responseText // Assuming you want to use comments for the response
																								       };

																								       fetch(`http://localhost:8080/api/feedbacks/thank-user`, {
																								           method: 'PUT',
																								           headers: {
																								               'Content-Type': 'application/json'
																								           },
																								           body: JSON.stringify(feedback)
																								       })
																								       .then(response => {
																								           if (!response.ok) throw new Error('Failed to send response');
																								           return response.json(); // Expecting a JSON response
																								       })
																								       .then(data => {
																								           alert(data.message); // Access the message property correctly
																								           closeResponseModal(); // Close the modal
																								           loadFeedbacks(); 
																										   const respondButton = document.querySelector(`button[data-feedback-id="${currentFeedbackId}"]`);
																										           if (respondButton) {
																										               respondButton.disabled = true; // Disable the button
																										               respondButton.style.backgroundColor = '#d3d3d3'; // Light shade
																										               respondButton.style.color = '#a9a9a9'; // Change text color to indicate it's disabled
																										               respondButton.style.cursor = 'not-allowed'; // Change cursor to indicate it's disabled
																										           }// Reload feedbacks to see any updates
																								       })
																								       .catch(error => {
																								           console.error('Error sending response:', error);
																								           alert('Error sending response: ' + error.message);
																								       });
																								   }																			  
																								   function loadFeedbacks() {
																								       const restaurantId = currentRestaurant.restaurantId; // Assuming you have the restaurant ID stored

																								       fetch(`http://localhost:8080/api/feedbacks/restaurant/${restaurantId}`)
																								           .then(response => {
																								               if (!response.ok) throw new Error('Failed to fetch feedbacks');
																								               return response.json();
																								           })
																								           .then(feedbacks => {
																								               const tbody = document.getElementById('feedbackBody');
																								               tbody.innerHTML = ''; // Clear previous feedbacks

																								               feedbacks.forEach(feedback => {
																								                   const row = document.createElement('tr');
																								                   row.innerHTML = `
																								                       <td>${feedback.userName || 'Anonymous'}</td> <!-- Access userName property -->
																								                       <td>${feedback.rating}</td>
																								                       <td>${feedback.comments || 'No comments'}</td> <!-- Handle missing comments -->
																								                       <td>${new Date(feedback.feedbackDate).toLocaleString()}</td>
																													   <td>
																													    <button class="btn btn-primary" data-feedback-id="${feedback.feedbackId}" onclick="openResponseModal(${feedback.feedbackId})">Respond</button>
																													    </td>
																								                   `;
																								                   tbody.appendChild(row);
																								               });
																								           })
																								           .catch(error => {
																								               console.error('Error loading feedbacks:', error);
																								               const tbody = document.getElementById('feedbackBody');
																								               tbody.innerHTML = '<tr><td colspan="4" class="text-center">Error loading feedbacks: ' + error.message + '</td></tr>';
																								           });
																								   }																			   
																								   function showFeedbackSection() {
																								   																							       // Hide other sections
																								   	 document.querySelectorAll('.content-section').forEach(section => {
																								   	 section.style.display = 'none';
																								   	});

																								   																							       // Show feedback section
																								   document.getElementById('feedbackSection').style.display = 'block';

																								   																							       // Load feedbacks
																								  loadFeedbacks();
																							  }

																							  
																							  function showReportsSection() {
																							      // Hide all sections first
																							      document.querySelectorAll('.content-section').forEach(section => {
																							          section.style.display = 'none';
																							      });
																							      
																							      // Show reports section
																							      document.getElementById('reportsSection').style.display = 'block';
																							      
																							      // Load reports
																							      loadReports();
																							      
																							      // Update active menu item
																							      updateActiveMenuItem(3); 
																							  }

																							  function loadReports() {
																							      fetch(`http://localhost:8080/api/reports/all`)
																							          .then(response => {
																							              if (!response.ok) throw new Error('Failed to fetch reports');
																							              return response.json();
																							          })
																							          .then(reports => {
																							              const tbody = document.getElementById('reportsBody');
																							              tbody.innerHTML = '';

																							              if (!reports || reports.length === 0) {
																							                  tbody.innerHTML = '<tr><td colspan="5" class="text-center">No reports found</td></tr>';
																							                  return;
																							              }

																							              reports.forEach(report => {
																							                  const row = document.createElement('tr');
																							                  row.innerHTML = `
																							                      <td>${report.reportId}</td>
																							                      <td>${report.reportType}</td>
																							                      <td>${report.startDate} to ${report.endDate}</td>
																							                      <td>${new Date(report.generatedAt).toLocaleString()}</td>
																							                      <td>
																							                          <div class="order-actions">
																							                              <button class="btn btn-info" onclick="viewReport(${report.reportId})">
																							                                  <i class="fas fa-eye"></i> View
																							                              </button>
																							                              <button class="btn btn-primary" onclick="downloadReport(${report.reportId})">
																							                                  <i class="fas fa-download"></i> Download
																							                              </button>
																							                              <button class="btn btn-danger" onclick="deleteReport(${report.reportId})">
																							                                  <i class="fas fa-trash"></i> Delete
																							                              </button>
																							                          </div>
																							                      </td>
																							                  `;
																							                  tbody.appendChild(row);
																							              });
																							          })
																							          .catch(error => {
																							              console.error('Error loading reports:', error);
																							              });
																							  }

																							  function generateReport(e) {
																							      e.preventDefault();
																							      
																							      const reportType = document.getElementById('reportType').value;
																							      const startDate = document.getElementById('startDate').value;
																							      const endDate = document.getElementById('endDate').value;
																							      
																							      // Basic validation
																							      if (!startDate || !endDate) {
																							          alert('Please select both start and end dates');
																							          return;
																							      }

																							      const reportRequest = {
																							          startDate: startDate,
																							          endDate: endDate
																							      };

																							      fetch(`http://localhost:8080/api/reports/generate`, {
																							          method: 'POST',
																							          headers: {
																							              'Content-Type': 'application/json'
																							          },
																							          body: JSON.stringify(reportRequest)
																							      })
																							      .then(async response => {
																							          if (!response.ok) {
																							              const errorData = await response.json().catch(() => null);
																							              throw new Error(errorData?.message || `HTTP error! status: ${response.status}`);
																							          }
																							          return response.json();
																							      })
																							      .then(data => {
																							          alert(`Report generated successfully! Report ID: ${data.reportId}`);
																							          loadReports(); // Refresh the reports list
																							      })
																							      .catch(error => {
																							          console.error('Error details:', error);
																							          alert(`Failed to generate report: ${error.message}`);
																							      });
																							  }
																							  function viewReport(reportId) {
																							      window.open(`http://localhost:8080/api/reports/${reportId}`, '_blank');
																							  }

																							  function downloadReport(reportId) {
																							      fetch(`http://localhost:8080/api/reports/export/csv`)
																							          .then(response => {
																							              if (!response.ok) throw new Error('Failed to download report');
																							              return response.blob();
																							          })
																							          .then(blob => {
																							              const url = window.URL.createObjectURL(blob);
																							              const a = document.createElement('a');
																							              a.href = url;
																							              a.download = `report_${reportId}.csv`;
																							              document.body.appendChild(a);
																							              a.click();
																							              window.URL.revokeObjectURL(url);
																							              document.body.removeChild(a);
																							          })
																							          .catch(error => {
																							              console.error('Error downloading report:', error);
																							              alert('Failed to download report: ' + error.message);
																							          });
																							  }
																							  function updateActiveMenuItem(index) {
																							      const menuItems = document.querySelectorAll('.sidebar-menu a');
																							      menuItems.forEach((item, i) => {
																							          item.classList.toggle('active', i === index);
																							      });
																							  }
																							  function deleteReport(reportId) {
																							      if (!confirm('Are you sure you want to delete this report?')) return;

																							      fetch(`http://localhost:8080/api/reports/${reportId}`, {
																							          method: 'DELETE'
																							      })
																							      .then(response => {
																							          if (!response.ok) throw new Error('Failed to delete report');
																							          return response.text();
																							      })
																							      .then(() => {
																							          alert('Report deleted successfully!');
																							          loadReports(); // Refresh the reports list
																							      })
																							      .catch(error => {
																							          console.error('Error:', error);
																							          alert('Failed to delete report: ' + error.message);
																							      });
																							  }							   
																								   
																								   
																								   
																								   
																								   
																								   
																			function logout() {
																               fetch('http://localhost:8080/api/restaurants/logout', {
																                   method: 'POST',
																                   credentials: 'include'
																               })
																               .then(() => {
																                   sessionStorage.removeItem('restaurant');
																                   window.location.href = '/';
																               })
																               .catch(error => {
																                   console.error('Logout error:', error);
																                   alert('Logout failed: ' + error.message);
																               });
																           }

																           // Close modal when clicking outside
																           window.addEventListener('click', function(event) {
																               if (event.target === document.getElementById('editModal')) {
																                   closeEditModal();
																               }
																           });
																		   function showOrdersSection() {
																		       // Hide all sections first
																		       document.querySelectorAll('.content-section').forEach(section => {
																		           section.style.display = 'none';
																		       });
																		       
																		       // Show orders section
																		       document.getElementById('ordersSection').style.display = 'block';
																		       
																		       // Load orders
																		       loadOrders();
																		       
																		       // Update active menu item
																		       updateActiveMenuItem(1);
																		   }

																		   function showMenuSection() {
																		       // Hide all sections first
																		       document.querySelectorAll('.content-section').forEach(section => {
																		           section.style.display = 'none';
																		       });
																		       
																		       // Show menu section
																		       document.getElementById('menuSection').style.display = 'block';
																		       
																		       // Update active menu item
																		       updateActiveMenuItem(0);
																		   }

																		   function updateActiveMenuItem(index) {
																		       const menuItems = document.querySelectorAll('.sidebar-menu a');
																		       menuItems.forEach((item, i) => {
																		           item.classList.toggle('active', i === index);
																		       });
																		   }
																       </script>
																	  
																   </body>
																   </html>
				