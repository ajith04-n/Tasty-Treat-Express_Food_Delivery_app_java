<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TastyTreatExpress - Restaurant Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: #fff;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #eee;
        }

        .sidebar-header h2 {
            font-size: 18px;
            color: #007bff;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #f0f5ff;
            color: #007bff;
        }

        .sidebar-menu a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
        }

        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .page-header {
            margin-bottom: 20px;
        }

        .page-header h2 {
            font-size: 22px;
            color: #333;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #0069d9;
        }

        /* Table Styles */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
        }

        /* Status Badges */
        .status-popular {
            background-color: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .status-regular {
            background-color: #2196F3;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .status-lowDemand {
            background-color: #FFC107;
            color: #333;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .btn-danger {
            background-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }
		/* Order Status Badges */
		.status-PENDING {
		    background-color: #FFC107;
		    color: #212529;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-PREPARING {
		    background-color: #2196F3;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-SHIPPED {
		    background-color: #17a2b8;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-DELIVERED {
		    background-color: #28a745;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		.status-CANCELLED {
		    background-color: #dc3545;
		    color: white;
		    padding: 3px 8px;
		    border-radius: 3px;
		    font-size: 0.8rem;
		}

		/* Order Actions */
		.order-actions {
		    display: flex;
		    gap: 5px;
		    flex-wrap: wrap;
		}

		.order-actions .btn {
		    padding: 5px 10px;
		    font-size: 0.8rem;
		}
    </style>
</head>
<body>
	<!--let currentOrderId = null; -->
<style>
	/* General Container */
.container {
  display: flex;
  background-color: #f7fafc;
  min-height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 250px;
  background-color: #2d3748; /* Dark gray */
  color: #ffffff;
  display: flex;
  flex-direction: column;
  padding: 20px;
  box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
}

.sidebar-header h2 {
  font-size: 1.5rem;
  font-weight: bold;
  color: #48bb78; /* Green accent */
  text-align: center;
  margin-bottom: 20px;
}

.sidebar-menu {
  list-style-type: none;
  padding: 0;
}

.sidebar-menu li {
  margin-bottom: 15px;
}

.sidebar-menu a {
  text-decoration: none;
  color: #ffffff;
  font-size: 1rem;
  display: flex;
  align-items: center;
  transition: background-color 0.3s ease, transform 0.3s ease;
  padding: 10px 15px;
  border-radius: 5px;
}

.sidebar-menu a.active {
  background-color: #48bb78; /* Highlight active link */
  color: #ffffff;
}

.sidebar-menu a:hover {
  background-color: #38a169; /* Hover effect */
  transform: scale(1.05);
}

.sidebar-menu i {
  margin-right: 10px;
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 20px;
}

.main-content h2 {
  font-size: 1.8rem;
  font-weight: bold;
  color: #2d3748;
  margin-bottom: 10px;
}

.main-content h3 {
  font-size: 1.5rem;
  color: #4a5568;
  margin-bottom: 10px;
}

#restaurant-info {
  background-color: #ffffff;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
}

#restaurant-info p {
  font-size: 1rem;
  color: #2d3748;
  margin-bottom: 8px;
}

/* Modal */
.modal {
  display: none; /* Initially hidden */
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #ffffff;
  width: 500px;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  z-index: 10;
}

.modal-content {
  padding: 20px;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  font-size: 1.5rem;
  color: #2d3748;
}

.modal-header .close-modal {
  background-color: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #718096;
  transition: color 0.3s ease;
}

.modal-header .close-modal:hover {
  color: #2d3748;
}

.modal-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}

.modal-footer label {
  font-size: 1rem;
  color: #4a5568;
}

.modal-footer select {
  padding: 8px;
  font-size: 1rem;
  border-radius: 5px;
  border: 1px solid #e2e8f0;
}

.modal-footer button {
  padding: 10px 15px;
  background-color: #48bb78;
  color: #ffffff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.modal-footer button:hover {
  background-color: #38a169;
}

/* Orders Section */
#ordersSection {
  margin-top: 20px;
}

.card {
  background-color: #ffffff;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  padding: 20px;
}

.table-responsive {
  overflow-x: auto;
  margin-top: 20px;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th {
  background-color: #2d3748;
  color: #ffffff;
  font-weight: bold;
  padding: 10px;
  text-align: left;
}

.table td {
  padding: 10px;
  border-bottom: 1px solid #e2e8f0;
}

.table tbody tr:hover {
  background-color: #edf2f7;
}

/* General Card Styling */
.card {
  background-color: #ffffff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
}

.card h3 {
  font-size: 1.5rem;
  font-weight: bold;
  color: #2d3748;
  margin-bottom: 15px;
}

/* Form Styling */
form .form-group {
  margin-bottom: 15px;
}

form .form-group label {
  display: block;
  font-size: 1rem;
  font-weight: bold;
  color: #4a5568;
  margin-bottom: 5px;
}

form .form-group input, 
form .form-group textarea, 
form .form-group select {
  width: 100%;
  padding: 10px;
  font-size: 1rem;
  border: 1px solid #e2e8f0;
  border-radius: 5px;
  transition: border-color 0.3s ease;
}

form .form-group input:focus, 
form .form-group textarea:focus, 
form .form-group select:focus {
  border-color: #4299e1;
  outline: none;
}

form .btn {
  background-color: #48bb78;
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease, transform 0.3s ease;
}

form .btn:hover {
  background-color: #38a169;
  transform: scale(1.05);
}

/* Table Styling */
.table-responsive {
  overflow-x: auto;
  margin-top: 20px;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th, 
.table td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #e2e8f0;
}

.table th {
  background-color: #2d3748;
  color: white;
  font-weight: bold;
}

.table tbody tr:hover {
  background-color: #edf2f7;
}

.table td .btn {
  background-color: #4299e1;
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 0.9rem;
  cursor: pointer;
}

.table td .btn:hover {
  background-color: #3182ce;
}

/* Modal Styling */
.modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  width: 500px;
  max-width: 90%;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  z-index: 1000;
}

.modal-content {
  padding: 20px;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-header h3 {
  font-size: 1.5rem;
  color: #2d3748;
}

.modal-header .close-modal {
  background-color: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #718096;
  transition: color 0.3s ease;
}

.modal-header .close-modal:hover {
  color: #2d3748;
}

.modal .form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.modal .btn-secondary {
  background-color: #e2e8f0;
  color: #2d3748;
}

.modal .btn-secondary:hover {
  background-color: #cbd5e0;
}

.modal .btn-primary {
  background-color: #48bb78;
  color: white;
}

.modal .btn-primary:hover {
  background-color: #38a169;
}



</style>

	<div class="container">
	       <!-- Sidebar -->
	       <div class="sidebar">
	           <div class="sidebar-header">
	               <h2>TastyTreatExpress</h2>
	           </div>
	           <ul class="sidebar-menu">
	               <li><a href="#menuLink" onclick="showMenuSection()" class="active"><i class="fas fa-list"></i> Menu Management</a></li>
				   <li><a href="#ordersLink" onclick="showOrdersSection()"><i class="fas fa-receipt"></i> Orders</a></li>
				    <li><a href="#" onclick="showFeedbackSection()"><i class="fas fa-comments"></i> Feedbacks</a></li>
				    <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
	           </ul>
	       </div>
		   
		   
	       <!-- Main Content -->
	       <div class="main-content">
	           <div th:if="${restaurant != null}">
	               <h2>Welcome, <span th:text="${restaurant.name}"></span></h2>
	               <h3>Restaurant Information</h3>
	               <div id="restaurant-info">
					<p><strong>Email:</strong> <span th:text="${restaurant.email}"></span></p>
					<p><strong>Address:</strong> <span th:text="${restaurant.address}"></span></p>
					<p><strong>Phone:</strong> <span th:text="${restaurant.phoneNumber}"></span></p>
					</div>
	           </div>
	           <div th:unless="${restaurant != null}">
	               <p>No restaurant data found. Please login again.</p>
	               <a href="/?showRestaurantLogin=true">Login</a>
	           </div>
			   <!-- Order Details Modal -->
			   <div class="modal" id="orderDetailsModal">
			       <div class="modal-content">
			           <div class="modal-header">
			               <h3>Order Details</h3>
			               <button class="close-modal" onclick="closeOrderModal()">&times;</button>
			           </div>
			           <div id="orderDetailsContent"></div>

			           <div class="modal-footer">
			               <label for="orderStatus">Update Status:</label>
			               <select id="orderStatus">
			                   <option value="Pending">Pending</option>
			                   <option value="In Progress">In Progress</option>
			                   <option value="Completed">Completed</option>
			                   <option value="Cancelled">Cancelled</option>
			               </select>
			               <button onclick="updateOrderStatus()">Update Status</button>
			           </div>
			       </div>
			   </div>

			   <div id="ordersSection" class="content-section" style="display: none;">
			                  <div class="card">
			                   <h3>Recent Orders</h3>
			                   <div class="table-responsive">
			                       <table class="table" id="ordersTable">
			                           <thead>
			                               <tr>
			                                   <th>Order ID</th>
			                                   <th>Customer</th>
			                                   <th>Items</th>
			                                   <th>Total</th>
			                                   <th>Status</th>
			                                   <th>Order Time</th>
			                                   <th>Actions</th>
			                               </tr>
			                           </thead>
			                           <tbody id="ordersBody">
			                               <!-- Orders will be loaded here dynamically -->
			                           </tbody>
			                       </table>
			                   </div>
			               </div>
</div>


			               <!-- Add New Item Form -->
						   <div id="menuSection" class="content-section">
			               <div class="card">
			                   <h3>Add New Menu Item</h3>
			                   <form id="addMenuItemForm" onsubmit="handleAddMenuItem(event)">
			                       <div class="form-group">
			                           <label for="name">Name:</label>
			                           <input type="text" id="name" name="name" required>
			                       </div>
			                       <div class="form-group">
			                           <label for="description">Description:</label>
			                           <textarea id="description" name="description"></textarea>
			                       </div>
			                       <div class="form-group">
			                           <label for="price">Price:</label>
			                           <input type="number" id="price" name="price" step="0.01" min="0" required>
			                       </div>
			                       <div class="form-group">
			                           <label for="quantity">Quantity:</label>
			                           <input type="number" id="quantity" name="quantity" min="0" required>
			                       </div>
			                       <div class="form-group">
			                           <label for="category">Category:</label>
			                           <select id="category" name="category">
			                               <option value="Appetizer">Appetizer</option>
			                               <option value="Main Course">Main Course</option>
			                               <option value="Dessert">Dessert</option>
			                               <option value="Beverage">Beverage</option>
			                           </select>
			                       </div>
			                       
	              
	                   <button type="submit" class="btn">Add Item</button>
	               </form>
	           </div>

	           <!-- Menu Items Table -->
	           <div class="card">
	               <h3>Your Menu Items</h3>
	               <div class="table-responsive">
	                   <table class="table" id="menuItemsTable">
	                       <thead>
	                           <tr>
	                               <th>Name</th>
	                               <th>Description</th>
	                               <th>Price</th>
	                               <th>Quantity</th>
	                               <th>Category</th>
	                               <th>Status</th>
								       <th>Actions</th>
								                           </tr>
								                       </thead>
								                       <tbody id="menuItemsBody">
								                           
								                       </tbody>
								                   </table>
								               </div>
								           </div>
								       

								   <!-- Edit Menu Item Modal -->
								   <div class="modal" id="editModal">
								       <div class="modal-content">
								           <div class="modal-header">
								               <h3>Edit Menu Item</h3>
								               <button class="close-modal" onclick="closeEditModal()">&times;</button>
								           </div>
								           <form id="editMenuItemForm" onsubmit="handleUpdateMenuItem(event)">
								               <input type="hidden" id="editItemId" name="menuId" value="1">
								               <div class="form-group">
								                   <label for="editName">Name:</label>
								                   <input type="text" id="editName" name="name" required>
								               </div>
								               <div class="form-group">
								                   <label for="editDescription">Description:</label>
								                   <textarea id="editDescription" name="description"></textarea>
								               </div>
								               <div class="form-group">
								                   <label for="editPrice">Price:</label>
								                   <input type="number" id="editPrice" name="price" step="0.01" min="0" required>
								               </div>
								               <div class="form-group">
								                   <label for="editQuantity">Quantity:</label>
								                   <input type="number" id="editQuantity" name="quantity" min="0" required>
								               </div>
								               <div class="form-group">
								                   <label for="editCategory">Category:</label>
								                   <select id="editCategory" name="category">
								                       <option value="Appetizer">Appetizer</option>
								                       <option value="Main Course">Main Course</option>
								                       <option value="Dessert">Dessert</option>
								                       <option value="Beverage">Beverage</option>
								                   </select>
								               </div>
								               <div class="form-actions">
								                   <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
								                   <button type="submit" class="btn btn-primary">Update Item</button>
								               </div>
								           </form>
								       </div>
								   </div>

								   <div id="restaurantData" 
								        th:data-restaurant-id="${restaurant.restaurantId}"
								        th:data-name="${restaurant.name}"
								        th:data-email="${restaurant.email}"
								        th:data-address="${restaurant.address}"
								        th:data-phone="${restaurant.phoneNumber}"
								        style="display: none;"></div>

								   <script>
								       // Global variable to store restaurant data
								       let currentRestaurant = null;

								       // On page load
								       document.addEventListener('DOMContentLoaded', function() {
								           const dataElement = document.getElementById('restaurantData');
								           const restaurantData = {
								               restaurantId: dataElement.dataset.restaurantId,
								               name: dataElement.dataset.name,
								               email: dataElement.dataset.email,
								               address: dataElement.dataset.address,
								               phoneNumber: dataElement.dataset.phone
								           };
								           sessionStorage.setItem('restaurant', JSON.stringify(restaurantData));
								           currentRestaurant = restaurantData;

								           // Load menu items
								           loadMenuItems();
										   loadOrders();
								       });

								       function loadMenuItems() {
								           if (!currentRestaurant || !currentRestaurant.restaurantId) {
								               console.error('No restaurant data available');
								               return;
								           }

								           fetch(`http://localhost:8080/api/menuItems/restaurant/${currentRestaurant.restaurantId}`)
								               .then(response => {
								                   if (!response.ok) throw new Error('Failed to fetch menu items');
								                   return response.json();
								               })
								               .then(items => {
								                   const tbody = document.getElementById('menuItemsBody');
								                   tbody.innerHTML = '';

								                   items.forEach(item => {
								                       const row = document.createElement('tr');
								                       
													   row.innerHTML = `
								                           <td>${item.name}</td>
								                           <td>${item.description || ''}</td>
								                           <td>$${item.price.toFixed(2)}</td>
								                           <td>${item.quantity}</td>
								                           <td>${item.category}</td>
								                           <td>
								                               <span class="status-${getStatus(item)}">${getStatus(item)}</span>
								                           </td>
								                           <td>
								                               <button class="btn btn-warning" 
								                                   data-id="${item.menuId}"
								                                   data-name="${item.name}"
								                                   data-description="${item.description || ''}"
								                                   data-price="${item.price}"
								                                   data-quantity="${item.quantity}"
														  data-category="${item.category}"
																                                       onclick="openEditModal(this)">
																                                       Edit
																                                   </button>
																                                   <button class="btn btn-danger" onclick="deleteMenuItem('${item.menuId}')">Delete</button>
																                               </td>
																                           `;
																                           tbody.appendChild(row);
																                       });
																                   })
																                   .catch(error => {
																                       console.error('Error loading menu items:', error);
																                       alert('Failed to load menu items: ' + error.message);
																                   });
																           }

																		   function loadOrders() {
																		       if (!currentRestaurant || !currentRestaurant.restaurantId) {
																		           console.error('No restaurant data available');
																		           return;
																		       }

																		       fetch(`http://localhost:8080/api/orders/restaurant/${currentRestaurant.restaurantId}`)
																		           .then(response => {
																		               if (!response.ok) throw new Error('Failed to fetch orders');
																		               return response.json();
																		           })
																		           .then(orders => {
																		               const tbody = document.getElementById('ordersBody');
																		               tbody.innerHTML = '';

																		               if (!orders || orders.length === 0) {
																		                   tbody.innerHTML = '<tr><td colspan="7" class="text-center">No orders found</td></tr>';
																		                   return;
																		               }

																		               // Fetch menu item details for each order
																		               const menuItemPromises = orders.map(order => {
																		                   return fetchMenuItems(order.menuItemIds).then(menuItems => {
																		                       return { ...order, menuItems }; // Combine order with its menu items
																		                   });
																		               });

																		               // Wait for all menu item details to be fetched
																		               Promise.all(menuItemPromises).then(ordersWithItems => {
																		                   ordersWithItems.forEach(order => {
																		                       const itemsList = order.menuItems && Array.isArray(order.menuItems) ?
																		                           order.menuItems.map(item => `<li>${item.quantity}x ${item.name}</li>`).join('') :
																		                           '<li>No items found</li>';

																		                       const row = document.createElement('tr');
																		                       row.innerHTML = `
																		                           <td>${order.orderId}</td>
																		                           <td>${order.userId}</td>
																		                           <td>
																		                               <ul class="order-items-list">
																		                                   ${itemsList}
																		                               </ul>
																		                           </td>
																		                           <td>$${order.totalAmount.toFixed(2)}</td>
																		                           <td>
																		                               <span class="status-${order.status}">${order.status}</span>
																		                           </td>
																		                           <td>${new Date(order.orderDate).toLocaleString()}</td>
																		                           <td>
																		                               <div class="order-actions">
																		                                   <button class="btn btn-info" onclick="viewOrderDetails(${order.orderId})">
																		                                       <i class="fas fa-eye"></i>
																		                                   </button>
																		                               </div>
																		                           </td>
																		                       `;
																		                       tbody.appendChild(row);
																		                   });
																		               });
																		           })
																		           .catch(error => {
																		               console.error('Error loading orders:', error);
																		               const tbody = document.getElementById('ordersBody');
																		               tbody.innerHTML = `<tr><td colspan="7" class="text-center">Error loading orders: ${error.message}</td></tr>`;
																		           });
																		   }

																		   // Function to fetch menu items based on their IDs
			
																		          function getStatus(item) {
																		              if (item.quantity > 20) return 'popular';
																		              if (item.quantity > 5) return 'regular';
																		              return 'lowDemand';
																		          }


																		   function openEditModal(button) {
																		       const itemId = button.getAttribute('data-id'); // Change from data-menuId to data-id
																		       const itemName = button.getAttribute('data-name');
																		       const itemDescription = button.getAttribute('data-description');
																		       const itemPrice = button.getAttribute('data-price');
																		       const itemQuantity = button.getAttribute('data-quantity');
																		       const itemCategory = button.getAttribute('data-category');

																		       document.getElementById('editItemId').value = itemId; // Ensure this is set correctly
																		       document.getElementById('editName').value = itemName;
																		       document.getElementById('editDescription').value = itemDescription || '';
																		       document.getElementById('editPrice').value = itemPrice;
																		       document.getElementById('editQuantity').value = itemQuantity;
																		       document.getElementById('editCategory').value = itemCategory;

																		       document.getElementById('editModal').style.display = 'flex';
																		   }

																           // Close edit modal
																           function closeEditModal() {
																               document.getElementById('editModal').style.display = 'none';
																           }
																		   function handleAddMenuItem(e) {
																		           e.preventDefault(); // Prevent the default form submission

																		           const formData = new FormData(e.target);
																		           const itemData = {
																		               name: formData.get('name'),
																		               description: formData.get('description'),
																		               price: parseFloat(formData.get('price')),
																		               quantity: parseInt(formData.get('quantity')),
																		               category: formData.get('category')
																		           };

																		           const restaurantId = currentRestaurant.restaurantId; // Ensure currentRestaurant is set

																		           fetch(`http://localhost:8080/api/menuItems/add/${restaurantId}`, {
																		               method: 'POST',
																		               headers: {
																		                   'Content-Type': 'application/json'
																		               },
																		               body: JSON.stringify(itemData)
																		           })
																		           .then(response => {
																		               if (!response.ok) throw new Error('Failed to add item');
																		               return response.json();
																		           })
																				           .then(() => {
																				               alert('Item added successfully!');
																				               e.target.reset(); // Reset the form fields
																				               loadMenuItems(); // Reload the menu items to reflect the new addition
																				           })
																				           .catch(error => {
																				               console.error('Error:', error);
																				               alert('Failed to add item: ' + error.message);
																				           });
																				       }
																				   
																					   function handleUpdateMenuItem(e) {
																					       e.preventDefault();
																					       const formData = new FormData(e.target);
																					       const itemData = Object.fromEntries(formData);
																						   if (!itemData.menuId || isNaN(itemData.menuId)) {
																						       alert('Invalid item ID');
																						       return;
																						   }

																					       fetch(`http://localhost:8080/api/menuItems/update`, {
																					           method: 'PUT',
																					           headers: {
																					               'Content-Type': 'application/json'
																					           },
																					           body: JSON.stringify({
																								menuId: parseInt(itemData.menuId), // Ensure this is a number
																								           name: itemData.name,
																								           description: itemData.description,
																								           price: parseFloat(itemData.price),
																								           category: itemData.category,
																								           imageUrl: itemData.imageUrl, // Include this if it's part of the form
																								           quantity: parseInt(itemData.quantity),
																								           isAvailable: itemData.isAvailable === 'true', // Convert to boolean
																								           status: itemData.status, // Include this if it's part of the form
																								           
																					           })
																					       })
																					       .then(response => {
																					           if (!response.ok) throw new Error('Failed to update item');
																					           return response.json();
																					       })
																					       .then(() => {
																					           alert('Item updated successfully!');
																					           closeEditModal();
																					           loadMenuItems(); // Reload the menu items after updating
																					       })
																					       .catch(error => {
																					           console.error('Error:', error);
																					           alert('Failed to update item: ' + error.message);
																					       });
																					   }										           

																					   function deleteMenuItem(itemId) {
																					       if (!confirm('Are you sure you want to delete this item?')) return;

																					       fetch(`http://localhost:8080/api/menuItems/delete/${itemId}`, {
																					           method: 'DELETE'
																					       })
																					       .then(response => {
																					           if (!response.ok) throw new Error('Failed to delete item');
																					           return response.json(); // Ensure the response is valid JSON
																					       })
																					       .then(data => {
																					           alert(data.message || 'Item deleted successfully!'); // Use the message from the response
																					           loadMenuItems(); // Reload the menu items after deleting
																					       })
																					       .catch(error => {
																					           console.error('Error:', error);
																					           alert('Failed to delete item: ' + error.message);
																					       });
																					   }
																					   function viewOrderDetails(orderId) {
																					       fetch(`http://localhost:8080/api/orders/${orderId}`)
																					           .then(response => {
																					               if (!response.ok) throw new Error('Failed to fetch order details');
																					               return response.json();
																					           })
																					           .then(order => {
																								document.getElementById('orderStatus').value = order.status;
																					               // First fetch the menu items details
																					               const itemFetchPromises = order.menuItemIds.map(itemId => 
																					                   fetch(`http://localhost:8080/api/menuItems/${itemId}`)
																					                       .then(res => res.json())
																					               );

																					               return Promise.all(itemFetchPromises)
																					                   .then(items => {
																					                       return {
																					                           ...order,
																					                           items: items,
																					                           id: order.orderId,
																					                           orderTime: order.orderDate
																					                       };
																					                   });
																					           })
																					           .then(fullOrder => {
																					               const content = document.getElementById('orderDetailsContent');
																					               content.innerHTML = `
																					                   <div class="order-detail">
																					                       <h4>Order #${fullOrder.orderId || 'N/A'}</h4>
																					                       <p><strong>Customer ID:</strong> ${fullOrder.userId || 'Guest'}</p>
																					                       <p><strong>Status:</strong> <span class="status-${fullOrder.status || 'UNKNOWN'}">${fullOrder.status || 'UNKNOWN'}</span></p>
																					                       <p><strong>Order Time:</strong> ${
																					                           fullOrder.orderTime ? 
																					                           new Date(fullOrder.orderTime).toLocaleString() : 
																					                           'Not available'
																					                       }</p>
																					                       <p><strong>Delivery Address:</strong> ${fullOrder.deliveryAddress || 'Not specified'}</p>
																					                       <p><strong>Payment Status:</strong> ${fullOrder.paymentStatus || 'Not specified'}</p>
																					                       
																					                       <h5>Items:</h5>
																					                       ${fullOrder.items && fullOrder.items.length > 0 ? `
																					                           <ul class="order-items-detail">
																					                               ${fullOrder.items.map(item => `
																					                                   <li>
																					                                       1x ${item.name || 'Unknown Item'} - 
																					                                       $${(item.price || 0).toFixed(2)} each
																					                                   </li>
																					                               `).join('')}
																					                           </ul>
																					                       ` : '<p>No items in this order</p>'}
																					                       
																					                       <div class="order-total">
																					                           <strong>Total Amount:</strong> $${fullOrder.totalAmount?.toFixed(2) || '0.00'}
																					                       </div>
																					                   </div>
																					               `;

																								   content.innerHTML = `
    <div class="order-detail">
      <h4>Order #${fullOrder.orderId || 'N/A'}</h4>
      <p><strong>Customer ID:</strong> ${fullOrder.userId || 'Guest'}</p>
      <p><strong>Status:</strong> 
        <span class="status-${fullOrder.status?.toLowerCase() || 'unknown'}">
          ${fullOrder.status || 'UNKNOWN'}
        </span>
      </p>
      <p><strong>Order Time:</strong> 
        ${fullOrder.orderTime 
          ? new Date(fullOrder.orderTime).toLocaleString() 
          : 'Not available'}
      </p>
      <p><strong>Delivery Address:</strong> 
        ${fullOrder.deliveryAddress || 'Not specified'}
      </p>
      <p><strong>Payment Status:</strong> 
        ${fullOrder.paymentStatus || 'Not specified'}
      </p>

      <h5>Items:</h5>
      ${fullOrder.items && fullOrder.items.length > 0 
        ? `
        <ul class="order-items-detail">
          ${fullOrder.items.map(item => `
            <li>
              1x ${item.name || 'Unknown Item'} - 
              $${(item.price || 0).toFixed(2)} each
            </li>
          `).join('')}
        </ul>
        ` : '<p>No items in this order</p>'}

      <div class="order-total">
        <strong>Total Amount:</strong> 
        $${fullOrder.totalAmount?.toFixed(2) || '0.00'}
      </div>
    </div>
  `;
																					               document.getElementById('orderDetailsModal').style.display = 'flex';
																					           })
																					           .catch(error => {
																					               console.error('Error:', error);
																					               const content = document.getElementById('orderDetailsContent');
																					               content.innerHTML = `<p class="error">Error loading order details: ${error.message}</p>`;
																					               document.getElementById('orderDetailsModal').style.display = 'flex';
																					           });
																					   }													   function fetchMenuItems(menuItemIds) {
																					       const promises = menuItemIds.map(id => {
																					           return fetch(`http://localhost:8080/api/menuItems/${id}`) // Adjust this endpoint as needed
																					               .then(response => {
																					                   if (!response.ok) throw new Error('Failed to fetch menu item');
																					                   return response.json();
																					               });
																					       });

																					       return Promise.all(promises);
																					   }
																								   function closeOrderModal() {
																								       document.getElementById('orderDetailsModal').style.display = 'none';
																								   }
																					               function cancelOrder(orderId) {
																					                   if (!confirm('Are you sure you want to cancel this order?')) return;

																					                   fetch(`http://localhost:8080/api/orders/cancel/${orderId}`, {
																					                       method: 'PUT'
																					                   })
																									   .then(response => {
																									           if (!response.ok) throw new Error(`Server responded with status ${response.status}`);
																									           return response.json();
																									       })
																										   
																					                   .then(() => {
																					                       alert('Order cancelled successfully!');
																					                       loadOrders();
																					                   })
																					                   .catch(error => {
																					                       console.error('Error:', error);
																					                       alert('Failed to cancel order: ' + error.message);
																					                   });
																					               }
																								   // Update order status
																								   function updateOrderStatus() {
																								       if (!currentOrderId) {
																								           alert('No order selected');
																								           return;
																								       }
																								       
																								       const statusSelect = document.getElementById('orderStatus');
																								       const newStatus = statusSelect.value;
																								       const updateBtn = document.querySelector('#orderDetailsModal .modal-footer button');
																								       
																								       if (!confirm(`Change order status to ${newStatus}?`)) return;

																								       updateBtn.disabled = true;
																								       updateBtn.textContent = 'Updating...';

																								       fetch(`http://localhost:8080/api/orders/updateStatus/${currentOrderId}`, {
																								           method: 'PUT',
																								           headers: {
																								               'Content-Type': 'application/json'
																								           },
																								           body: JSON.stringify({ status: newStatus })
																								       })
																								       .then(response => {
																								           if (!response.ok) throw new Error('Failed to update status');
																								           return response.json();
																								       })
																								       .then(() => {
																								           alert('Status updated successfully!');
																								           closeOrderModal();
																								           loadOrders(); // Refresh the order list
																								       })
																								       .catch(error => {
																								           console.error('Error:', error);
																								           alert('Error updating status: ' + error.message);
																								       })
																								       .finally(() => {
																								           updateBtn.disabled = false;
																								           updateBtn.textContent = 'Update Status';
																								       });
																								   }										   
																			function logout() {
																               fetch('http://localhost:8080/api/restaurants/logout', {
																                   method: 'POST',
																                   credentials: 'include'
																               })
																               .then(() => {
																                   sessionStorage.removeItem('restaurant');
																                   window.location.href = '/';
																               })
																               .catch(error => {
																                   console.error('Logout error:', error);
																                   alert('Logout failed: ' + error.message);
																               });
																           }

																           // Close modal when clicking outside
																           window.addEventListener('click', function(event) {
																               if (event.target === document.getElementById('editModal')) {
																                   closeEditModal();
																               }
																           });
																		   function showOrdersSection() {
																		       // Hide all sections first
																		       document.querySelectorAll('.content-section').forEach(section => {
																		           section.style.display = 'none';
																		       });
																		       
																		       // Show orders section
																		       document.getElementById('ordersSection').style.display = 'block';
																		       
																		       // Load orders
																		       loadOrders();
																		       
																		       // Update active menu item
																		       updateActiveMenuItem(1);
																		   }

																		   function showMenuSection() {
																		       // Hide all sections first
																		       document.querySelectorAll('.content-section').forEach(section => {
																		           section.style.display = 'none';
																		       });
																		       
																		       // Show menu section
																		       document.getElementById('menuSection').style.display = 'block';
																		       
																		       // Update active menu item
																		       updateActiveMenuItem(0);
																		   }

																		   function updateActiveMenuItem(index) {
																		       const menuItems = document.querySelectorAll('.sidebar-menu a');
																		       menuItems.forEach((item, i) => {
																		           item.classList.toggle('active', i === index);
																		       });
																		   }

																		   // Event listeners for menu links
document.addEventListener("DOMContentLoaded", () => {
  const menuLinks = document.querySelectorAll(".sidebar-menu a");
  menuLinks.forEach(link => {
    link.addEventListener("click", (event) => {
      event.preventDefault(); // Prevent default anchor behavior

      // Highlight the active link
      menuLinks.forEach(l => l.classList.remove("active"));
      event.currentTarget.classList.add("active");
	  // Show the corresponding section
	  if (link.id === "ordersLink") {
		showOrdersSection();
		} else if (link.id === "menuLink") {
			showMenuSection();
			}

      // Determine the section to show
      const targetSectionId = event.currentTarget.getAttribute("data-section");
      navigateToSection(targetSectionId);
    });
  });
});
																       </script>
																	   <div class="modal-footer">
																	       <label for="orderStatus">Update Status:</label>
																	       <select id="orderStatus">
																	           <option value="PENDING">Pending</option>
																	           <option value="PREPARING">Preparing</option>
																	           <option value="SHIPPED">Shipped</option>
																	           <option value="DELIVERED">Delivered</option>
																	           <option value="CANCELLED">Cancelled</option>
																	       </select>
																	       <button class="btn btn-primary" onclick="updateOrderStatus()">Update Status</button>
																	   </div>
																   </body>
																   </html>
				